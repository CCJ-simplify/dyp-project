<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
<p id="p"></p>
<video src="" id="video"></video>
<video src="" id="video2"></video>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
	// Prefer camera resolution nearest to 1280x720.
	var buffer = []
	var i = 0
	var constraints = { audio: true }
	var audio = navigator.mediaDevices.getUserMedia(constraints)
			.then(function(mediaStream) {
				// var ws = new WebSocket("wss://192.168.10.108:9903/zx/pcm")
				// ws.onopen=function(so){
				//     alert('success')
				//     console.log('socket connect success')
				//     ws.send(JSON.stringify({'command': 'info', 'studentId': 'studentId'}))
				//     ws.send(JSON.stringify({'command': 'onCall', 'studentId': 'studentId', 'teacherId': 'teacherId'}))
				// }
				// ws.onerror = function(res){
				//     alert('error')
				// }

				// ws.onmessage = function (msg){
				// 	console.log(msg)
				// 	// var video = document.querySelector('video')
				//  //       video.srcObject = mediaStream
				// 	// video.onloadedmetadata = function(e) {
				//  //       	video.play()
				//  //       }
				// }
				var mediaRecorder = new MediaRecorder(mediaStream)
				mediaRecorder.ondataavailable = function(blob) {
					buffer.push(blob.data)
					var recordedVideo = document.getElementById('video2')
					const superBuffer = new Blob(buffer, {type: 'video/webm'})
					recordedVideo.src = URL.createObjectURL(superBuffer)
					recordedVideo.controls = true
					recordedVideo.play()
				}
				mediaRecorder.start(1000)
			}).catch(function(err) { alert(err.name + ": " + err.message); }); // always check for errors at the end.
</script>
</body>
</html>